//////////////////////////////////////////////////
// Copyright (C) 2006 Burlex for WoWd Project
//////////////////////////////////////////////////

// DARKMOON FAIRE EVENT SCRIPT

#include "StdAfx.h"

/* Script Export Declarations */

extern "C" WOWD_SCRIPT_DECL void ScriptInitialize(ScriptModule *mod);
extern "C" WOWD_SCRIPT_DECL EventScript* CreateWoWEvent(MapMgr *instance);
extern "C" WOWD_SCRIPT_DECL bool HandleDummySpell(uint32 uSpellId, uint32 i, Spell* pSpell);
extern "C" WOWD_SCRIPT_DECL bool HandleDummyAura(uint32 uSpellId, uint32 i, Aura* pAura, bool apply);
extern "C" WOWD_SCRIPT_DECL GameObjectAIScript* CreateGameObjectAIClass(uint32 uEntryId, GameObject *gameobject);

// Build version info function
BUILD_VERSIONINFO_DATA(SCRIPTLIB_VERSION_MAJOR, SCRIPTLIB_VERSION_MINOR);

/* This is needed because windows is a piece of shit. ;) */
#ifdef WIN32

    BOOL APIENTRY DllMain( HANDLE hModule, DWORD  ul_reason_for_call, LPVOID lpReserved )
    {
        return TRUE;
    }

#endif

// Spawning class
class EDarkmoonFaire : public EventScript
{
public:
	EDarkmoonFaire(MapMgr *instance) : EventScript(instance)
	{
		_interface = instance->GetInterface();
	}

	struct CSpawn
	{
		uint32 entry;
		uint32 mapid;
		float x;
		float y;
		float z;
		float o;
		uint32 emote_state;
		uint32 npc_flag;
	};

	struct GSpawn
	{
		uint32 entry;
		uint32 mapid;
		float x;
		float y;
		float z;
		float o;

		uint32 flags;
		float rot;
		float rot1;
		float rot2;
		float rot3;
		uint32 gstate;
		float facing;
		uint32 dynflags;
		uint32 faction;
		uint32 type_id;
		uint32 level;
		
	};
	void Execute()
	{
		SpawnCreatures();
		SpawnGameObjects();
	}

	void SpawnCreatures()
	{
		static CSpawn spawns[] =
		{
			{ 3937, 0, -9528.96, -14.4237, 55.8871, 0.98242, 0, 4 },		// Kira Songshine
			{ 14869, 0, -9553.48, 122.953, 59.0131, 4.01919, 0, 0 },		// Pygmy Cockatrice
			{ 14869, 0, -9540.16, 124.875, 59.0065, 6.04277, 0, 0 },		// Pygmy Cockatrice
			{ 14865, 0, -9555.53, 115.845, 58.9683, 5.74213, 0, 0 },		// Felinni
			{ 14844, 0, -9561.12, 69.9691, 59.2053, 1.01229, 0, 5 },		// Sylannia
			{ 14828, 0, -9533.65, 95.1698, 58.9648, 4.03171, 0, 3 },		// Gelvas Grimegate
			{ 15303, 0, -9568.32, -7.84619, 63.0966, 1.79769, 0, 1 },		// Maxima Blastenheimer
			{ 620, 0, -9471.76, 50.7757, 57.2775, 4.35335, 0, 0 },		// Chicken
			{ 14847, 0, -9560.98, 103.642, 58.9648, 5.5676, 0, 7 },		// Professor Thaddeus Paleo
			{ 14822, 0, -9536.62, 73.2432, 58.9648, 1.90241, 0, 3 },		// Sayge
			{ 14868, 0, -9538.58, 133.231, 58.9648, 4.03171, 0, 0 },		// Hornsley
			{ 721, 0, -9630.81, -344.209, 58.4348, 2.35067, 0, 0 },		// Rabbit
			{ 14845, 0, -9564.5, 72.2799, 59.1869, 0.663225, 0, 5 },		// Stamp Thunderhorn
			{ 14841, 0, -9576.4, 87.7237, 58.9648, 6.23083, 0, 3 },		// Rinling
			{ 2046, 0, -9462.29, 87.8151, 58.4211, 0.733038, 0, 16388 },		// Andrew Krighton
			{ 14846, 0, -9557.49, 105.464, 58.9648, 4.64258, 0, 5 },		// Lhara
			{ 6374, 0, -9466.97, -5.52935, 49.8766, 4.57276, 0, 5 },		// Cylina Darkheart
			{ 66, 0, -9494.13, 83.9096, 56.6586, 5.96903, 0, 4 },		// Tharynn Bouden
			{ 2442, 0, -9584.48, -446.939, 58.4129, 0.444419, 0, 0 },		// Cow
			{ 14867, 0, -9610.19, 59.462, 60.3892, 0.101808, 0, 0 },		// Jubjub
			{ 10445, 0, -9541.73, 87.4378, 59.3029, 6.23083, 0, 1 },		// Selina Dourman
			{ 14849, 0, -9585.5, 35.7403, 60.1675, 4.43768, 0, 1 },		// Darkmoon Faire Carnie
			{ 620, 0, -9462.47, 50.4159, 56.5487, 0.901604, 0, 0 },		// Chicken
			{ 14827, 0, -9534.56, 79.9132, 59.0065, 0.0698132, 0, 3 },		// Burth
			{ 14823, 0, -9530.5, 80.2024, 58.9648, 0.20944, 0, 3 },		// Silas Darkmoon
			{ 14869, 0, -9548.77, 137.507, 58.9143, 2.97546, 0, 0 },		// Pygmy Cockatrice
			{ 14833, 0, -9579.73, 23.0371, 60.8328, 4.93928, 0, 3 },		// Chronos
			{ 15218, 0, -9570.28, -9.95068, 63.5196, 6.12611, 0, 0 },		// Faire Cannon Trigger
			{ 620, 0, -9432.1, 128.16, 59.0506, 4.58019, 0, 0 },		// Chicken
			{ 14849, 0, -9556.91, 65.415, 59.423, 0.942144, 0, 1 },		// Darkmoon Faire Carnie
			{ 14864, 0, -9545.01, 129.984, 59.0065, 4.11549, 0, 0 },		// Khaz Modan Ram
			{ 14832, 0, -9558.18, 130.175, 58.9648, 5.70723, 0, 3 },		// Kerri Hicks
			{ 721, 0, -9597.42, -250.937, 57.9682, 5.54207, 0, 0 },		// Rabbit
			{ 14871, 0, -9566.38, 31.1655, 61.4444, 1.58825, 0, 1 },		// Morja
			{ 14860, 0, -9580.15, 54.5256, 61.2096, 0.0664383, 0, 5 },		// Flik
			{ 2442, 0, -9578.9, -320.8, 61.7879, 4.30698, 0, 0 },		// Cow
			{ 14866, 0, -9570.0, 54.5566, 60.548, 0.140116, 0, 1 },		// Flik's Frog
			{ 1922, 0, -9500.31, -528.023, 63.4085, 6.25975, 0, 0 },		// Gray Forest Wolf
			{ 797, 0, -9465.13, 109.086, 57.6094, 4.81769, 0, 0 },		// Bo
			{ 14869, 0, -9549.51, 112.08, 59.0065, 4.45538, 0, 0 },		// Pygmy Cockatrice
			{ 0, 0, 0.0, 0.0, 0.0, 0.0, 0, 0 },
		};

		CSpawn *cs;

        for(uint32 i = 0; spawns[i].entry != 0; ++i)
		{
			cs = &spawns[i];
			Creature *pCreature = _interface->SpawnCreature(cs->entry, cs->x, cs->y, cs->z, cs->o, false, 0, 0);
			if(pCreature == 0) continue;
			pCreature->SetUInt32Value(UNIT_NPC_EMOTESTATE, cs->emote_state);
			pCreature->SetUInt32Value(UNIT_NPC_FLAGS, cs->npc_flag);
			pCreature->AddToWorld();

			CSpawns.push_back(pCreature);
		}
	}

	void SpawnGameObjects()
	{
        static GSpawn spawns[] =
		{
			{ 180043, 0, -9563.43, 99.4973, 58.8815, -1.64061, 0, 0, 0, 0.731354, -0.681998, 1, -1.64061, 0, 0, 5, 0 }, 		// Free Standing Torch 01
			{ 180573, 0, -9503.83, -373.21, 57.7377, 0.314159, 32, 0, 0, 0.156434, 0.987688, 1, 0.314159, 0, 0, 5, 0 }, 		// Cannon Target
			{ 179970, 0, -9568.37, 76.0546, 58.8809, -1.6057, 0, 0, 0, 0.71934, -0.694658, 1, -1.6057, 0, 0, 5, 0 }, 		// Replace Crate 02
			{ 180043, 0, -9541.98, 80.8587, 59.1252, -0.0872668, 0, 0, 0, 0.0436195, -0.999048, 1, -0.0872668, 0, 0, 5, 0 }, 		// Free Standing Torch 01
			{ 180045, 0, -9580.79, 28.3274, 60.6627, -1.309, 32, 0, 0, 0.608761, -0.793353, 1, -1.309, 0, 0, 5, 0 }, 		// Stormwind Gypsy Wagon
			{ 180335, 0, -9569.42, 74.9086, 58.9041, -0.366519, 0, 0, 0, 0.182236, -0.983255, 1, -0.366519, 0, 0, 5, 0 }, 		// Darkmoon Faire Music Doodad
			{ 3719, 0, -9458.53, 8.58518, 56.9626, 2.98451, 0, 0, 0, 0.996917, 0.0784591, 1, 2.98451, 0, 94, 3, 0 }, 		// Food Crate
			{ 179965, 0, -9572.57, -13.6808, 63.4354, 1.67552, 32, 0, 0, 0.743145, 0.669131, 1, 1.67552, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 2061, 0, -9456.23, 24.3172, 56.9157, 3.01942, 0, 0, 0, 0.998135, 0.0610483, 1, 3.01942, 0, 14, 6, 1 }, 		// Campfire
			{ 180042, 0, -9576.61, 89.6703, 58.8815, 0.575959, 32, 0, 0, 0.284015, 0.95882, 1, 0.575959, 0, 0, 5, 0 }, 		// Target Practice Tent
			{ 22774, 0, -9456.23, 24.3172, 56.9157, 3.01942, 0, 0, 0, 0.998135, 0.0610483, 1, 3.01942, 0, 0, 8, 0 }, 		// Cozy Fire
			{ 180043, 0, -9533.74, 74.5172, 58.8815, -1.27409, 0, 0, 0, 0.594823, -0.803857, 1, -1.27409, 0, 0, 5, 0 }, 		// Free Standing Torch 01
			{ 180040, 0, -9558.64, 119.835, 58.854, -1.20428, 32, 0, 0, 0.566406, -0.824126, 1, -1.20428, 0, 114, 0, 0 }, 		// G_Cage 02
			{ 180035, 0, -9610.89, 17.2324, 62.4941, -1.46608, 32, 0, 0, 0.669131, -0.743145, 1, -1.46608, 0, 0, 5, 0 }, 		// Fence
			{ 180036, 0, -9551.95, 41.1687, 61.8756, -0.418879, 32, 0, 0, 0.207912, -0.978148, 1, -0.418879, 0, 0, 5, 0 }, 		// Darkmoon Faire Wagon Unloaded
			{ 180035, 0, -9556.89, 4.93777, 61.6764, 0.715585, 32, 0, 0, 0.350207, 0.936672, 1, 0.715585, 0, 0, 5, 0 }, 		// Fence
			{ 1617, 0, -9567.63, -332.694, 62.3448, 0.20944, 0, 0, 0, 0.104528, 0.994522, 1, 0.20944, 0, 0, 3, 0 }, 		// Silverleaf
			{ 179965, 0, -9566.68, -12.5996, 63.2657, 1.85005, 32, 0, 0, 0.798636, 0.601815, 1, 1.85005, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 180035, 0, -9549.23, 65.4561, 60.4817, 0.418879, 32, 0, 0, 0.207912, 0.978148, 1, 0.418879, 0, 0, 5, 0 }, 		// Fence
			{ 180043, 0, -9539.89, 72.8221, 58.8815, 2.72271, 0, 0, 0, 0.978148, 0.207912, 1, 2.72271, 0, 0, 5, 0 }, 		// Free Standing Torch 01
			{ 180036, 0, -9595.65, 45.7297, 62.5579, -3.12414, 32, 0, 0, 0.999962, -0.00872653, 1, -3.12414, 0, 0, 5, 0 }, 		// Darkmoon Faire Wagon Unloaded
			{ 106318, 0, -9484.18, -349.415, 59.8835, 2.70526, 0, 0, 0, 0.976296, 0.21644, 1, 2.70526, 0, 94, 3, 0 }, 		// Battered Chest
			{ 2061, 0, -9469.2, -6.83347, 57.4436, -0.0174545, 0, 0, 0, -0.00872713, 0.999962, 1, -0.0174545, 0, 14, 6, 1 }, 		// Campfire
			{ 180029, 0, -9515.35, 86.6149, 59.0797, 2.96706, 32, 0, 0, 0.996195, 0.0871558, 1, 2.96706, 0, 0, 5, 0 }, 		// DARKMOON FAIRE
			{ 22775, 0, -9469.2, -6.83347, 57.4436, -0.0174545, 0, 0, 0, -0.00872713, 0.999962, 1, -0.0174545, 0, 0, 8, 0 }, 		// Cozy Fire
			{ 180035, 0, -9534.68, 63.1606, 60.2981, -0.0523599, 32, 0, 0, 0.026177, -0.999657, 1, -0.0523599, 0, 0, 5, 0 }, 		// Fence
			{ 179965, 0, -9569.41, 97.0819, 58.8815, -0.628319, 32, 0, 0, 0.309017, -0.951056, 1, -0.628319, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 180524, 0, -9549.28, 28.2097, 59.4478, 2.79253, 64, 0, 0, 0.984808, 0.173648, 1, 2.79253, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 2061, 0, -9470.47, -7.262, 57.4436, 1.38754, 0, 0, 0, 0.639439, 0.768842, 1, 1.38754, 0, 14, 6, 1 }, 		// Campfire
			{ 180524, 0, -9553.61, 67.2332, 59.2847, 1.29154, 66, 0, 0, 0.601815, 0.798636, 1, 1.29154, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 94, 0, -9500.08, 67.9826, 55.993, -0.261799, 0, 0, 0, -0.130526, 0.991445, 1, -0.261799, 0, 0, 5, 0 }, 		// Westfall
			{ 22776, 0, -9470.47, -7.262, 57.4436, 1.38754, 0, 0, 0, 0.639439, 0.768842, 1, 1.38754, 0, 0, 8, 0 }, 		// Cozy Fire
			{ 179968, 0, -9535.4, 112.285, 58.8815, 1.58825, 0, 0, 0, 0.71325, 0.700909, 1, 1.58825, 0, 0, 5, 0 }, 		// Haystack 01
			{ 179975, 0, -9535.88, 110.817, 58.8815, 1.36136, 0, 0, 0, 0.62932, 0.777146, 1, 1.36136, 0, 0, 5, 0 }, 		// Water Trough Small
			{ 179975, 0, -9560.94, 127.774, 58.9152, 1.27409, 0, 0, 0, 0.594823, 0.803857, 1, 1.27409, 0, 0, 5, 0 }, 		// Water Trough Small
			{ 180037, 0, -9553.33, 110.428, 59.1801, -1.25664, 0, 0, 0, 0.587785, -0.809017, 1, -1.25664, 0, 0, 5, 0 }, 		// Haybail 01
			{ 179965, 0, -9530.22, 74.4355, 58.8815, 1.98968, 32, 0, 0, 0.838671, 0.544639, 1, 1.98968, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 180524, 0, -9522.69, 74.1969, 59.1998, 2.46091, 2, 0, 0, 0.942641, 0.333807, 1, 2.46091, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 180524, 0, -9596.53, 56.3289, 60.5527, 0.10472, 66, 0, 0, 0.052336, 0.99863, 1, 0.10472, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 180031, 0, -9563.75, 66.4712, 60.5913, -1.93732, 32, 0, 0, 0.824126, -0.566406, 1, -1.93732, 0, 0, 5, 0 }, 		// Food Tent
			{ 180049, 0, -9573.65, 33.65, 61.7434, -1.36136, 0, 0, 0, 0.629321, -0.777146, 1, -1.36136, 0, 0, 5, 0 }, 		// Mug 01
			{ 180035, 0, -9530.71, 125.602, 59.8683, -1.43117, 32, 0, 0, 0.656059, -0.75471, 1, -1.43117, 0, 0, 5, 0 }, 		// Fence
			{ 179972, 0, -9570.34, 73.6059, 58.9049, 0.872665, 0, 0, 0, 0.422618, 0.906308, 1, 0.872665, 0, 0, 5, 0 }, 		// Stormwind Crate 01
			{ 177496, 0, -9461.86, 13.7346, 56.9748, 1.05592, 0, 0, 0, 0.503774, 0.863835, 1, 1.05592, 0, 0, 7, 0 }, 		// Wooden Chair
			{ 180515, 0, -9569.68, -13.0052, 63.4714, -1.36136, 0, 0, 0, 0.629321, -0.777146, 1, -1.36136, 0, 35, 10, 0 }, 		// Blastenheimer 5000 Ultra Cannon
			{ 180038, 0, -9532.87, 120.536, 59.2362, -2.96706, 0, 0, 0, 0.996195, -0.0871558, 1, -2.96706, 0, 0, 5, 0 }, 		// Haybail 02
			{ 180524, 0, -9566.92, 99.248, 58.8815, -0.925024, 2, 0, 0, 0.446198, -0.894934, 1, -0.925024, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 180048, 0, -9573.39, 33.7, 61.7433, 0.977384, 0, 0, 0, 0.469472, 0.882948, 1, 0.977384, 0, 0, 5, 0 }, 		// Mug Foam 01
			{ 179968, 0, -9533.8, 128.406, 59.6028, -2.16421, 0, 0, 0, 0.882948, -0.469472, 1, -2.16421, 0, 0, 5, 0 }, 		// Haystack 01
			{ 2061, 0, -9456.12, 21.3815, 56.9157, 1.31772, 0, 0, 0, 0.612217, 0.79069, 1, 1.31772, 0, 14, 6, 1 }, 		// Campfire
			{ 180044, 0, -9547.15, 84.5487, 58.1561, -0.907571, 32, 0, 0, 0.438371, -0.898794, 1, -0.907571, 0, 0, 5, 0 }, 		// Shoutbox
			{ 180040, 0, -9557.69, 134.367, 58.8329, -2.26893, 32, 0, 0, 0.906308, -0.422618, 1, -2.26893, 0, 114, 0, 0 }, 		// G_Cage 02
			{ 180035, 0, -9576.97, -3.4292, 63.2808, -3.10669, 32, 0, 0, 0.999848, -0.0174524, 1, -3.10669, 0, 0, 5, 0 }, 		// Fence
			{ 22772, 0, -9456.12, 21.3815, 56.9157, 1.31772, 0, 0, 0, 0.612217, 0.79069, 1, 1.31772, 0, 0, 8, 0 }, 		// Cozy Fire
			{ 1560, 0, -9463.14, -2.22515, 63.8205, 1.43117, 4, 0, 0, 0.656059, 0.75471, 1, 1.43117, 0, 0, 3, 0 }, 		// Storage Chest
			{ 180006, 0, -9555.57, 54.1968, 60.1749, 2.11185, 0, 0, 0, 0.870356, 0.492424, 1, 2.11185, 0, 0, 5, 0 }, 		// Outhouse
			{ 179965, 0, -9528.68, 91.8029, 58.8889, -2.56563, 32, 0, 0, 0.95882, -0.284015, 1, -2.56563, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 180049, 0, -9571.81, 28.07, 61.9897, 2.79253, 0, 0, 0, 0.984808, 0.173648, 1, 2.79253, 0, 0, 5, 0 }, 		// Mug 01
			{ 179968, 0, -9559.52, 130.32, 58.8953, 0.750492, 0, 0, 0, 0.366501, 0.930418, 1, 0.750492, 0, 0, 5, 0 }, 		// Haystack 01
			{ 180045, 0, -9573.3, 37.0724, 60.4675, 3.00197, 32, 0, 0, 0.997564, 0.0697565, 1, 3.00197, 0, 0, 5, 0 }, 		// Stormwind Gypsy Wagon
			{ 93, 0, -9500.09, 68.0035, 56.5492, -0.261799, 0, 0, 0, -0.130526, 0.991445, 1, -0.261799, 0, 0, 5, 0 }, 		// Westbrook Garrison
			{ 179965, 0, -9595.09, 62.8271, 61.7528, 2.75762, 32, 0, 0, 0.981627, 0.190809, 1, 2.75762, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 180035, 0, -9545.69, 27.9266, 60.59, -2.25147, 32, 0, 0, 0.902585, -0.430511, 1, -2.25147, 0, 0, 5, 0 }, 		// Fence
			{ 180030, 0, -9534.2, 68.6959, 59.3954, -1.69297, 32, 0, 0, 0.748956, -0.66262, 1, -1.69297, 0, 0, 5, 0 }, 		// Fortune Teller's Tent
			{ 180034, 0, -9530, 99.0359, 59.3857, -0.994838, 32, 0, 0, 0.477159, -0.878817, 1, -0.994838, 0, 0, 5, 0 }, 		// Ticket Master Tent
			{ 180035, 0, -9551.88, 55.3052, 61.1185, 1.95477, 32, 0, 0, 0.829038, 0.559193, 1, 1.95477, 0, 0, 5, 0 }, 		// Fence
			{ 175749, 0, -9461.34, 16.1169, 64.9663, -1.41372, 0, 0, 0, 0.649448, -0.760406, 1, -1.41372, 0, 0, 9, 0 }, 		// Icecrown and the Frozen Throne
			{ 180038, 0, -9554.68, 138.057, 59.187, -1.01229, 0, 0, 0, 0.48481, -0.87462, 1, -1.01229, 0, 0, 5, 0 }, 		// Haybail 02
			{ 180043, 0, -9531.2, 117.723, 59.1229, 2.05949, 0, 0, 0, 0.857167, 0.515038, 1, 2.05949, 0, 0, 5, 0 }, 		// Free Standing Torch 01
			{ 180045, 0, -9568.85, 26.1816, 61.2764, 0.767945, 32, 0, 0, 0.374607, 0.927184, 1, 0.767945, 0, 0, 5, 0 }, 		// Stormwind Gypsy Wagon
			{ 180035, 0, -9598.97, 1.93641, 62.1301, 2.77507, 32, 0, 0, 0.983255, 0.182236, 1, 2.77507, 0, 0, 5, 0 }, 		// Fence
			{ 180035, 0, -9533.44, 109.463, 60.0964, -1.95477, 32, 0, 0, 0.829038, -0.559193, 1, -1.95477, 0, 0, 5, 0 }, 		// Fence
			{ 180006, 0, -9559.52, 53.4495, 60.136, 1.36136, 0, 0, 0, 0.62932, 0.777146, 1, 1.36136, 0, 0, 5, 0 }, 		// Outhouse
			{ 179965, 0, -9587.79, -0.867133, 60.8399, -1.72788, 32, 0, 0, 0.760406, -0.649448, 1, -1.72788, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 180035, 0, -9539.58, 138.433, 60.2842, 2.53073, 32, 0, 0, 0.953717, 0.300706, 1, 2.53073, 0, 0, 5, 0 }, 		// Fence
			{ 180035, 0, -9523.69, 69.3342, 60.3902, 1.01229, 32, 0, 0, 0.48481, 0.87462, 1, 1.01229, 0, 0, 5, 0 }, 		// Fence
			{ 179975, 0, -9535.4, 130.943, 58.8839, 2.33874, 0, 0, 0, 0.920505, 0.390731, 1, 2.33874, 0, 0, 5, 0 }, 		// Water Trough Small
			{ 2061, 0, -9455, 23.3205, 56.9157, 0.383973, 0, 0, 0, 0.190809, 0.981627, 1, 0.383973, 0, 14, 6, 1 }, 		// Campfire
			{ 180048, 0, -9577.74, 29.818, 61.5466, 0.663225, 0, 0, 0, 0.325568, 0.945519, 1, 0.663225, 0, 0, 5, 0 }, 		// Mug Foam 01
			{ 180524, 0, -9595.88, 5.00358, 61.3745, 0.837758, 64, 0, 0, 0.406737, 0.913545, 1, 0.837758, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 180524, 0, -9552.22, 111.492, 58.8853, 0.261799, 2, 0, 0, 0.130526, 0.991445, 1, 0.261799, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 22773, 0, -9455, 23.3205, 56.9157, 0.383973, 0, 0, 0, 0.190809, 0.981627, 1, 0.383973, 0, 0, 8, 0 }, 		// Cozy Fire
			{ 179965, 0, -9542.1, 69.9565, 58.8932, 1.8326, 32, 0, 0, 0.793353, 0.608761, 1, 1.8326, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 180047, 0, -9571.72, 27.8073, 61.4719, -1.06465, 0, 0, 0, 0.507538, -0.861629, 1, -1.06465, 0, 0, 5, 0 }, 		// Westfall Chair
			{ 180043, 0, -9537.02, 98.595, 58.8815, -2.9147, 0, 0, 0, 0.993572, -0.113203, 1, -2.9147, 0, 0, 5, 0 }, 		// Free Standing Torch 01
			{ 180524, 0, -9574.56, 79.7395, 58.8815, 0.593412, 2, 0, 0, 0.292372, 0.956305, 1, 0.593412, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 4090, 0, -9460.03, 94.2031, 56.5335, -1.54462, 0, 0, 0, -0.69779, 0.716302, 1, -1.54462, 0, 0, 8, 0 }, 		// Forge
			{ 180035, 0, -9558.93, 135.616, 60.3051, -2.25147, 32, 0, 0, 0.902585, -0.430511, 1, -2.25147, 0, 0, 5, 0 }, 		// Fence
			{ 180035, 0, -9542.16, 42.035, 60.9323, -1.22173, 32, 0, 0, 0.573576, -0.819152, 1, -1.22173, 0, 0, 5, 0 }, 		// Fence
			{ 180047, 0, -9573.48, 33.6922, 61.2497, -1.71042, 0, 0, 0, 0.75471, -0.656059, 1, -1.71042, 0, 0, 5, 0 }, 		// Westfall Chair
			{ 180524, 0, -9584.94, 79.6764, 60.4523, -1.16937, 0, 0, 0, 0.551937, -0.833886, 1, -1.16937, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 4088, 0, -9455, 98.4979, 58.3415, -2.7838, 0, 0, 0, 0.984041, -0.177944, 1, -2.7838, 0, 0, 8, 0 }, 		// Anvil
			{ 179968, 0, -9536.48, 108.306, 58.8908, -2.75762, 0, 0, 0, 0.981627, -0.190809, 1, -2.75762, 0, 0, 5, 0 }, 		// Haystack 01
			{ 180043, 0, -9530.79, 92.2459, 58.8815, -3.12414, 0, 0, 0, 0.999962, -0.00872653, 1, -3.12414, 0, 0, 5, 0 }, 		// Free Standing Torch 01
			{ 180041, 0, -9556.3, 116.333, 58.8582, -1.98968, 32, 0, 0, 0.838671, -0.544639, 1, -1.98968, 0, 114, 0, 0 }, 		// G_Cage 03
			{ 179968, 0, -9533.51, 127.849, 58.9001, 2.94961, 0, 0, 0, 0.995396, 0.0958458, 1, 2.94961, 0, 0, 5, 0 }, 		// Haystack 01
			{ 180039, 0, -9550.79, 144.551, 59.3467, 2.54818, 32, 0, 0, 0.956305, 0.292372, 1, 2.54818, 0, 0, 5, 0 }, 		// Animal Trainer Tent
			{ 180036, 0, -9601.2, 17.0259, 64.1117, -1.48353, 32, 0, 0, 0.67559, -0.737277, 1, -1.48353, 0, 0, 5, 0 }, 		// Darkmoon Faire Wagon Unloaded
			{ 179965, 0, -9572.74, 40.4953, 60.4069, 1.44862, 32, 0, 0, 0.66262, 0.748956, 1, 1.44862, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 179968, 0, -9558.87, 131.45, 58.8875, -1.91986, 0, 0, 0, 0.819152, -0.573576, 1, -1.91986, 0, 0, 5, 0 }, 		// Haystack 01
			{ 181029, 0, -9574.1, 30.2205, 61.2259, 1.22173, 0, 0, 0, 0.573576, 0.819152, 1, 1.22173, 0, 14, 6, 1 }, 		// Burning Coals
			{ 180524, 0, -9520.97, 91.3967, 59.3657, -2.46091, 2, 0, 0, 0.942641, -0.333807, 1, -2.46091, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 179965, 0, -9572.12, 77.6323, 58.882, 0.558505, 32, 0, 0, 0.275637, 0.961262, 1, 0.558505, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 180035, 0, -9602.03, 54.2494, 61.6601, 0.994838, 32, 0, 0, 0.477159, 0.878817, 1, 0.994838, 0, 0, 5, 0 }, 		// Fence
			{ 180035, 0, -9562.45, 120.571, 60.4093, -1.13446, 32, 0, 0, 0.5373, -0.843391, 1, -1.13446, 0, 0, 5, 0 }, 		// Fence
			{ 180053, 0, -9574.1, 30.2205, 61.2259, 1.22173, 0, 0, 0, 0.573576, 0.819152, 1, 1.22173, 0, 0, 8, 0 }, 		// Brazier
			{ 179965, 0, -9538.01, 103.002, 58.9158, -2.1293, 32, 0, 0, 0.87462, -0.48481, 1, -2.1293, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 179965, 0, -9526.89, 62.1373, 59.5495, -0.872665, 32, 0, 0, 0.422618, -0.906308, 1, -0.872665, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 180035, 0, -9521.37, 96.6575, 60.8029, -0.855212, 32, 0, 0, 0.414693, -0.909961, 1, -0.855212, 0, 0, 5, 0 }, 		// Fence
			{ 180524, 0, -9602.75, 37.4567, 61.5828, -0.279253, 64, 0, 0, 0.139173, -0.990268, 1, -0.279253, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 2061, 0, -9456.42, 22.8661, 56.9157, -2.17294, 0, 0, 0, 0.884988, -0.465614, 1, -2.17294, 0, 14, 6, 1 }, 		// Campfire
			{ 179968, 0, -9535.15, 113.199, 58.8815, -1.76278, 0, 0, 0, 0.771625, -0.636078, 1, -1.76278, 0, 0, 5, 0 }, 		// Haystack 01
			{ 180047, 0, -9577.95, 29.7229, 61.0439, -2.72271, 0, 0, 0, 0.978148, -0.207912, 1, -2.72271, 0, 0, 5, 0 }, 		// Westfall Chair
			{ 179965, 0, -9566.78, -2.01318, 61.7573, -1.3439, 32, 0, 0, 0.622515, -0.782608, 1, -1.3439, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 179965, 0, -9513.38, 86.4162, 59.6696, -0.349066, 32, 0, 0, 0.173648, -0.984808, 1, -0.349066, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 22777, 0, -9456.42, 22.8661, 56.9157, -2.17294, 0, 0, 0, 0.884988, -0.465614, 1, -2.17294, 0, 0, 8, 0 }, 		// Cozy Fire
			{ 179968, 0, -9534.25, 128.669, 58.9019, -0.767945, 0, 0, 0, 0.374607, -0.927184, 1, -0.767945, 0, 0, 5, 0 }, 		// Haystack 01
			{ 180043, 0, -9573.83, 82.3919, 58.8815, 2.56563, 0, 0, 0, 0.95882, 0.284015, 1, 2.56563, 0, 0, 5, 0 }, 		// Free Standing Torch 01
			{ 179965, 0, -9564.48, 128.845, 59.1488, 2.93215, 32, 0, 0, 0.994522, 0.104528, 1, 2.93215, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 180032, 0, -9560.39, 106.003, 60.5481, 3.00197, 32, 0, 0, 0.997564, 0.0697565, 1, 3.00197, 0, 0, 5, 0 }, 		// Souvenir Tent
			{ 179965, 0, -9607.73, 7.57964, 60.9326, -2.42601, 32, 0, 0, 0.936672, -0.350207, 1, -2.42601, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 180524, 0, -9546.56, 87.8324, 59.4187, -3.03687, 2, 0, 0, 0.99863, -0.0523359, 1, -3.03687, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 180524, 0, -9544.44, 140.065, 58.8815, -2.04204, 2, 0, 0, 0.85264, -0.522498, 1, -2.04204, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 180043, 0, -9566.04, 76.5801, 58.8981, 0.855211, 0, 0, 0, 0.414693, 0.909961, 1, 0.855211, 0, 0, 5, 0 }, 		// Free Standing Torch 01
			{ 180524, 0, -9576.87, -0.897786, 62.1091, 1.88496, 64, 0, 0, 0.809017, 0.587785, 1, 1.88496, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 180524, 0, -9533.17, 124.821, 58.9729, -2.9147, 0, 0, 0, 0.993572, -0.113203, 1, -2.9147, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 180524, 0, -9533.64, 115.556, 58.9128, 2.89725, 2, 0, 0, 0.992546, 0.121869, 1, 2.89725, 0, 35, 1, 0 }, 		// Tonk Control Console
			{ 180043, 0, -9553.62, 104.592, 58.8828, -1.98968, 0, 0, 0, 0.838671, -0.544639, 1, -1.98968, 0, 0, 5, 0 }, 		// Free Standing Torch 01
			{ 179965, 0, -9532.9, 133.527, 58.986, 0.575959, 32, 0, 0, 0.284015, 0.95882, 1, 0.575959, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 180035, 0, -9586.5, 90.3664, 61.4895, -1.6057, 32, 0, 0, 0.71934, -0.694658, 1, -1.6057, 0, 0, 5, 0 }, 		// Fence
			{ 180036, 0, -9558.04, 15.1922, 63.009, 0.715585, 32, 0, 0, 0.350207, 0.936672, 1, 0.715585, 0, 0, 5, 0 }, 		// Darkmoon Faire Wagon Unloaded
			{ 180035, 0, -9590.48, 72.2718, 62.8057, -2.04204, 32, 0, 0, 0.85264, -0.522498, 1, -2.04204, 0, 0, 5, 0 }, 		// Fence
			{ 180037, 0, -9542, 136.385, 59.2148, -1.13446, 0, 0, 0, 0.5373, -0.843391, 1, -1.13446, 0, 0, 5, 0 }, 		// Haybail 01
			{ 1618, 0, -9582.88, 16.6436, 60.1078, -2.80998, 0, 0, 0, 0.986286, -0.165048, 0, -2.80998, 0, 0, 3, 0 }, 		// Peacebloom
			{ 96, 0, -9500.54, 66.0703, 56.0072, 2.87979, 0, 0, 0, 0.991445, 0.130526, 1, 2.87979, 0, 0, 5, 0 }, 		// Redridge
			{ 179965, 0, -9515.8, 75.137, 59.6035, -0.226893, 32, 0, 0, 0.113203, -0.993572, 1, -0.226893, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 179967, 0, -9570.38, 73.6094, 60.0989, 2.26893, 0, 0, 0, 0.906308, 0.422618, 1, 2.26893, 0, 0, 5, 0 }, 		// Barrel 01
			{ 179973, 0, -9569.09, 74.8281, 58.8618, 0.261799, 0, 0, 0, 0.130526, 0.991445, 1, 0.261799, 0, 0, 5, 0 }, 		// Inn Barrel
			{ 179965, 0, -9551.97, 106.014, 58.8853, -1.43117, 32, 0, 0, 0.656059, -0.75471, 1, -1.43117, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 180038, 0, -9560.48, 123.28, 59.2266, 0.20944, 0, 0, 0, 0.104528, 0.994522, 1, 0.20944, 0, 0, 5, 0 }, 		// Haybail 02
			{ 180043, 0, -9556.71, 69.5335, 58.9567, -0.820305, 0, 0, 0, 0.398749, -0.91706, 1, -0.820305, 0, 0, 5, 0 }, 		// Free Standing Torch 01
			{ 179965, 0, -9540.73, 34.5314, 59.5549, -0.191986, 32, 0, 0, 0.0958458, -0.995396, 1, -0.191986, 0, 0, 5, 0 }, 		// Darkmoon Faire Banner
			{ 180035, 0, -9576.63, 74.4836, 60.7141, -0.820305, 32, 0, 0, 0.398749, -0.91706, 1, -0.820305, 0, 0, 5, 0 }, 		// Fence
			{ 180040, 0, -9538.27, 133.446, 58.8815, 2.47837, 32, 0, 0, 0.945519, 0.325568, 1, 2.47837, 0, 114, 0, 0 }, 		// G_Cage 02
			{ 180043, 0, -9557.68, 54.6593, 60.3315, 1.71042, 0, 0, 0, 0.75471, 0.656059, 1, 1.71042, 0, 0, 5, 0 }, 		// Free Standing Torch 01
			{ 0, 0, 0.0, 0.0, 0.0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 },
		};

		GSpawn* gs;
		for(uint32 i = 0; spawns[i].entry != 0; ++i)
		{
            gs = &spawns[i];
			GameObject *pGo = _interface->SpawnGameObject(gs->entry, gs->x, gs->y, gs->z, gs->o, false, 0, 0);
            if(pGo == 0) continue;

			pGo->SetUInt32Value(GAMEOBJECT_FLAGS, gs->flags);
			pGo->SetFloatValue(GAMEOBJECT_ROTATION, gs->rot);
			pGo->SetFloatValue(GAMEOBJECT_ROTATION_01, gs->rot1);
			pGo->SetFloatValue(GAMEOBJECT_ROTATION_02, gs->rot2);
			pGo->SetFloatValue(GAMEOBJECT_ROTATION_03, gs->rot3);
			pGo->SetUInt32Value(GAMEOBJECT_STATE, gs->gstate);
			pGo->SetFloatValue(GAMEOBJECT_FACING, gs->facing);
			pGo->SetUInt32Value(GAMEOBJECT_DYN_FLAGS, gs->dynflags);
			pGo->SetUInt32Value(GAMEOBJECT_FACTION, gs->faction);
			pGo->SetUInt32Value(GAMEOBJECT_TYPE_ID, gs->type_id);
			pGo->SetUInt32Value(GAMEOBJECT_LEVEL, gs->level);

			pGo->AddToWorld();
			GOSpawns.push_back(pGo);
		}
	}

	void Remove()
	{
		script_debuglog("DARKMOON FAIRE SCRIPT: Removing %u creatures.", CSpawns.size());
		script_debuglog("DARKMOON FAIRE SCRIPT: Removing %u gameobjects.", GOSpawns.size());
		for(vector<Creature*>::iterator itr = CSpawns.begin(); itr != CSpawns.end(); ++itr)
		{
			(*itr)->RemoveFromWorld();
			_interface->DeleteCreature(*itr);
		}

		for(vector<GameObject*>::iterator itr = GOSpawns.begin(); itr != GOSpawns.end(); ++itr)
		{
			(*itr)->RemoveFromWorld();
			_interface->DeleteGameObject(*itr);
		}
		script_debuglog("DARKMOON FAIRE SCRIPT: Removal complete.");
		CSpawns.clear();
		GOSpawns.clear();
	}

	void Delete()
	{
		Remove();
		delete this;
	}

protected:
	MapScriptInterface *_interface;
	vector<GameObject*> GOSpawns;
	vector<Creature*> CSpawns;
};



void ScriptInitialize(ScriptModule *mod)
{
	sScriptMgr.ScriptAddEventModule(0, mod);
	sScriptMgr.ScriptAddGameObjectModule(180515, mod);

}

EventScript* CreateWoWEvent(MapMgr *instance)
{
	return new EDarkmoonFaire(instance);
}

/************************************************************************/
/* OBJECT SCRIPTING SECTION                                             */
/************************************************************************/

class EDarkmoonFaireCannon : public GameObjectAIScript
{
public:
	EDarkmoonFaireCannon(GameObject* go) : GameObjectAIScript(go)
	{

	}

	void OnActivate(Player * pPlayer)
	{
		SpellEntry *sp1 = sSpellStore.LookupEntry(24831);
		SpellEntry *sp2 = sSpellStore.LookupEntry(24832);
		// Cast cannon prep spell on target.
		pPlayer->CastSpell(pPlayer, 24832, false);

		// Update our flags (ONLY FOR THIS PLAYER THOUGH, LETS HAVE FUN WITH MULTIPLE PEOPLE IN THE CANNON)
        _gameobject->BuildFieldUpdatePacket(pPlayer, GAMEOBJECT_FLAGS, 1);
	}

	void Destroy()
	{
		delete this;
	}
};

bool HandleDummySpell(uint32 uSpellId, uint32 i, Spell* pSpell)
{
	if(uSpellId == 24831)
	{
		// We'll handle everything through this one. Teleport, etc.

		// Transport the player to in front of the launcher.
		//pSpell->playerTarget->AddEventP0
	}
	return false;
}

bool HandleDummyAura(uint32 uSpellId, uint32 i, Aura* pAura, bool apply)
{
	return false;
}

GameObjectAIScript * CreateGameObjectAIClass(uint32 uEntryId, GameObject *gameobject)
{
	switch(uEntryId)
	{
	case 180515:	// Cannon
		return new EDarkmoonFaireCannon(gameobject);
		break;
	}

	return 0;

}